{% extends 'base_page.html' %}

{% load dsqla %}
{% load compress %}
{% load static %}


{% block style_includes %}
    {{ block.super }}

    <link rel='stylesheet' type='text/css' href='{% static 'characters/css/character_detail.css' %}' />
    <link rel='stylesheet' type='text/css' href='{% static 'css/rating.css' %}' />
{% endblock style_includes %}


{% block script_includes %}
    {{ block.super }}

    <script type='text/javascript' src='{% static 'js/libraries/d3-3.5.5.js' %}'></script>

    <!-- chronicles -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'accounts/coffeescript/models/user.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'chronicles/coffeescript/models/chronicle.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'chronicles/coffeescript/models/game.coffee' %}'></script>
    {% endcompress %}

    <!-- traits -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/affiliation.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/attribute.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/character_text.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/combat_trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/creature_type.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/flaw.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/genealogy.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/merit.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/misc_trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/power.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/skill.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/subgroup.coffee' %}'></script>
    {% endcompress %}

    <!-- characters -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_attribute.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_character_text.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_combat_trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_flaw.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_merit.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_misc_trait.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_power.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_skill.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_skill_specialty.coffee' %}'></script>
        {# <script type='text/coffeescript' src='{% static 'characters/coffeescript/models/character_has_xp.coffee' %}'></script> #}
    {% endcompress %}

    <!-- view-models -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'coffeescript/ko_bindings/dot_rating.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'accounts/coffeescript/viewmodels/user.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'characters/coffeescript/viewmodels/edit_main.coffee' %}'></script>
    {% endcompress %}
{% endblock script_includes %}


{% block content %}
    <header class="charsheet-header">
        <!-- ko if: character.name() != '' -->
            <h1 data-bind="text: character.name()"></h1>
        <!-- /ko -->
        <!-- ko if: character.name() == '' -->
            <h1>(new character)</h1>
        <!-- /ko -->
        <p><em>Played by:</em> <span data-bind="text: character.user().name()"></span></p>
    </header>

    <section id='general-character-traits'>
        <span class='label'>Character Name:</span> <input type='text' name='name' data-bind="value: character.name()" /><br />
        <span class='label'>Character Status:</span> <span data-bind="text: character.status().name"></span><br />
        <span class='label'>Creature Type:</span> <select name='creature_type' data-bind="
                options: character.available.creature_types,
                optionsText: 'label',
                value: character.creature_type
            "></select><br />
        <!-- ko if: character.creature_type().genealogy_name() != null -->
            <span class='label' data-bind="text: character.creature_type().genealogy_name"></span> <select name='genealogy' data-bind="
                    options: character.available.genealogies,
                    optionsText: 'label',
                    value: character.genealogy
                "></select><br />
        <!-- /ko -->
        <!-- ko if: character.creature_type().affiliation_name() != null -->
            <span class='label' data-bind="text: character.creature_type().affiliation_name"></span> <select name='affiliation' data-bind="
                    options: character.available.affiliations,
                    optionsText: 'label',
                    value: character.affiliation
                "></select><br />
        <!-- /ko -->
        <!-- ko if: character.creature_type().subgroup_name() != null -->
            <span class='label' data-bind="text: character.creature_type().subgroup_name"></span> <select name='subgroup' data-bind="
                    options: character.available.subgroups,
                    optionsText: 'label',
                    value: character.subgroup
                "></select><br />
        <!-- /ko -->

        {% comment %}
        {# only include these for mortals (and ghouls?) #}
        <span class='label'>Virtue:</span> <select name='virtue'></select><br />
        <span class='label'>Vice:</span> <select name='vice'></select><br />
        {% endcomment %}
    </section>

    <section id='attributes'>
        <h2>Attributes</h2>
        <div id='mental-attributes' style='width: 33.33333%'>
            <h3>Mental</h3>
            <ul class='trait-list' data-bind="foreach: character.mental_attributes">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
        <div id='physical-attributes' style='width: 33.33333%'>
            <h3>Physical</h3>
            <ul class='trait-list' data-bind="foreach: character.physical_attributes">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
        <div id='social-attributes' style='width: 33.33333%'>
            <h3>Social</h3>
            <ul class='trait-list' data-bind="foreach: character.social_attributes">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
    </section>

    <section id='skills'>
        <h2>Skills</h2>
        <div id='mental-skills' style='width: 33.33333%'>
            <h3>Mental</h3>
            <ul class='trait-list' data-bind="foreach: character.mental_skills">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
        <div id='physical-skills' style='width: 33.33333%'>
            <h3>Physical</h3>
            <ul class='trait-list' data-bind="foreach: character.physical_skills">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
        <div id='social-skills' style='width: 33.33333%'>
            <h3>Social</h3>
            <ul class='trait-list' data-bind="foreach: character.social_skills">
                <li>
                    <span class='stat-label' data-bind="text: trait().label()"></span>
                    <div data-bind="dot_rating: $data"></div>
                </li>
            </ul>
        </div>
    </section>

    <!-- bootstrap data -->
    <script type='text/javascript'>
{{ models | create_js_records | safe }}

window.character = new ORM.characters.Character(
    {{ character | serialize_json | safe }},
    { parse: true }
);
    </script>

    {% compress js %}
        <script type='text/coffeescript'>
            window.character_view_model =
                'character': new VM.characters.CharacterViewModel character

            # VM.characters.CharacterTrait.available_viewmodel = master_view_model.available
            ko.applyBindings character_view_model
        </script>
    {% endcompress %}
{% endblock content %}
