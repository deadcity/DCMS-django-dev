{% extends 'base_page.html' %}

{% load compress %}
{% load js_filters %}
{% load model_filters %}
{% load static %}

{% block style_includes %}
    {{ block.super }}

    <link rel='stylesheet' type='text/css' href='{% static 'character/css/character_detail.css' %}' />
{% endblock style_includes %}

{% block script_includes %}
    {{ block.super }}

    <!-- libs -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'coffeescript/tools.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'coffeescript/enum.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'coffeescript/svg_tools.coffee' %}'></script>
    {% endcompress %}

    <!-- character summary -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'character/coffeescript/models/character.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/creaturetype.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/genealogy.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/affiliation.coffee' %}'></script>
        <script type='text/coffeescript' src='{% static 'traits/coffeescript/models/subgroup.coffee' %}'></script>
    {% endcompress %}

    <!-- views -->
    {% compress js %}
        <script type='text/coffeescript' src='{% static 'character/coffeescript/views/edit_character_summary.coffee' %}'></script>
    {% endcompress %}
{% endblock script_includes %}


{% block content %}
    <script type='text/html' id='template_character-summary'>
        <div id='character-basics'>
            <span class='label'>Character Name:</span> <input type='text' name='name' value='<%= name %>' /><br />
            <span class='label'>Character Status:</span> <%= status.name %><br />
            <span class='label'><%= creature_type.genealogy_name %>:</span> <select name='genealogy'></select><br />
            <span class='label'><%= creature_type.affiliation_name %>:</span> <select name='affiliation'></select><br />
            <span class='label'><%= creature_type.subgroup_name %>:</span> <select name='subgroup'></select><br />
            <span class='label'>Virtue:</span> <select name='virtue'></select><br />
            <span class='label'>Vice:</span> <select name='vice'></select><br />
        </div>
    </script>

    {% compress js %}
    <script type='text/coffeescript'>
        Tools.create_namespace 'Traits.Enums'
        Tools.create_namespace 'Traits.Objects'

        Traits.Enums.Vice   = new Enum.Enum {{ vices   | serialize_json | safe }}
        Traits.Enums.Virtue = new Enum.Enum {{ virtues | serialize_json | safe }}

        Traits.Objects.Affiliation  = new Backbone.Collection {{ affiliations   | serialize_json | safe }}, {model: Traits.Models.Affiliation  }
        Traits.Objects.CreatureType = new Backbone.Collection {{ creature_types | serialize_json | safe }}, {model: Traits.Models.CreatureType }
        Traits.Objects.Genealogy    = new Backbone.Collection {{ genealogies    | serialize_json | safe }}, {model: Traits.Models.Genealogy    }
        Traits.Objects.Subgroup     = new Backbone.Collection {{ subgroups      | serialize_json | safe }}, {model: Traits.Models.Subgroup     }

        Traits.Enums.AttributeType   = new Enum.Enum {{ attribute_types   | serialize_json | safe }}
        Traits.Enums.DerangementType = new Enum.Enum {{ derangement_types | serialize_json | safe }}
        Traits.Enums.FlawType        = new Enum.Enum {{ flaw_types        | serialize_json | safe }}
        Traits.Enums.MeritType       = new Enum.Enum {{ merit_types       | serialize_json | safe }}
        Traits.Enums.SkillType       = new Enum.Enum {{ skill_types       | serialize_json | safe }}

        Traits.Objects.Attributes     = new Backbone.Collection {{ attributes      | serialize_json | safe }}, {model: Traits.Models.Attribute     }
        Traits.Objects.CharacterTexts = new Backbone.Collection {{ character_texts | serialize_json | safe }}, {model: Traits.Models.CharacterText }
        Traits.Objects.CombatTraits   = new Backbone.Collection {{ combat_traits   | serialize_json | safe }}, {model: Traits.Models.CombatTrait   }
        Traits.Objects.Derangements   = new Backbone.Collection {{ derangements    | serialize_json | safe }}, {model: Traits.Models.Derangement   }
        Traits.Objects.Flaws          = new Backbone.Collection {{ flaws           | serialize_json | safe }}, {model: Traits.Models.Flaw          }
        Traits.Objects.Merits         = new Backbone.Collection {{ merits          | serialize_json | safe }}, {model: Traits.Models.Merit         }
        Traits.Objects.MiscTraits     = new Backbone.Collection {{ misc_traits     | serialize_json | safe }}, {model: Traits.Models.MiscTrait     }
        Traits.Objects.Powers         = new Backbone.Collection {{ powers          | serialize_json | safe }}, {model: Traits.Models.Power         }
        Traits.Objects.Skills         = new Backbone.Collection {{ skills          | serialize_json | safe }}, {model: Traits.Models.Skill         }
    </script>
    {% endcompress %}

    <header class="charsheet-header">
        <h1>{% if name %}<%= name %>{% else %}New Character{% endif %}</h1>
        <p><span class='label'>Played by:</span> {{ character.user.realname }}</p>
    </header>

    <section id='general-character-traits'>
    </section>
    <section id='attributes'>
    </section>
    <section id='skills'>
    </section>
    <section id='skill-specialties'>
    </section>
    <div class="row">
        <section id='powers'>
        </section>
        <section id='merits'>
        </section>
        <section id='flaws'>
        </section>
    </div>
    <div class="row">
        <section id='combat'>
        </section>
        <section id='supernatural'>
        </section>
        <section id='derangements'>
        </section>
    </div>

    {% compress js %}
    <script type='text/coffeescript'>
        charcter_summary = new Character.Views.CharacterSummary
            el: $ '#general-character-traits'
            template: _.template $('#template_character-summary').html()
            model: new Character.Models.Character({{ character | serialize_json | safe }}, { parse: true })
        charcter_summary.render()
    </script>
    {% endcompress %}
{% endblock content %}
